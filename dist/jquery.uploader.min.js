(()=>{"use strict";var e={n:i=>{var t=i&&i.__esModule?()=>i.default:()=>i;return e.d(t,{a:t}),t},d:(i,t)=>{for(var l in t)e.o(t,l)&&!e.o(i,l)&&Object.defineProperty(i,l,{enumerable:!0,get:t[l]})},o:(e,i)=>Object.prototype.hasOwnProperty.call(e,i)};const i=jQuery;var t=e.n(i);const l="jqueryUploader",r="defaultUploaderOptions",s=".jquery-uploader-preview-action",a=".jquery-uploader-preview-action .file-delete",o=".jquery-uploader-preview-progress";function n(){let e=[],i="0123456789abcdef";for(let t=0;t<36;t++)e[t]=i.substr(Math.floor(16*Math.random()),1);return e[14]="4",e[19]=i.substr(3&e[19]|8,1),e[8]=e[13]=e[18]=e[23]="-",e.join("")}class d{constructor(e,i){this.$originEle=e;let l=window[r]?window[r]:{};this.options=t().extend(!0,{},d.defaults,l,i),this.files=[],this.checkOptions(),this.initEle(),this.initEvent()}checkOptions(){if(this.options.mode!==d.mode.url)throw`暂不支持的模式 ${this.options.mode}`;if("text"!==this.$originEle.attr("type")&&this.$originEle.attr("type"))throw`url模式下，元素的类型只能为 text,不能为 ${this.$originEle.attr("type")}`}initEle(){if(this.$originEle.css("display","none"),this.$selectCard=t()('<div class="jquery-uploader-select-card">\n                <div class="jquery-uploader-select">\n                    <div class="upload-button">\n                        <i class="fa fa-plus"></i><br/>\n                        <a>上传</a>\n                    </div>\n                </div>\n            </div>'),this.$uploaderContainer=t()('<div class="jquery-uploader-preview-container"></div>'),this.$uploader=t()('<div class="jquery-uploader"></div>').append(this.$uploaderContainer),this.options.parent?this.options.parent.append(this.$uploader):this.$originEle.parent().append(this.$uploader),this.options.mode===d.mode.url){let e=this.$originEle.val();this.createDefaultFiles(e)}this.$originEle.trigger("uploader-init")}upload(){return this.handleFileUpload(),this.$originEle}clean(){return this.files=[],this.refreshPreviewFileList(),this.refreshValue(),this.$originEle}uploadFiles(){return this.files}initEvent(){}refreshValue(){let e=this.$originEle.val(),i=[];this.files.forEach((e=>{e.status!==d.fileStatus.uploaded&&e.status!==d.fileStatus.initial||i.push(e.url)}));let t=i.join(",");e!==t&&this.$originEle.val(t).trigger("change")}refreshPreviewFileList(){this.$uploaderContainer.empty(),this.files.forEach((e=>{this.$uploaderContainer.append(e.$ele),e.$ele.find(a).on("click",this.handleFileDelete.bind(this))})),(this.options.multiple||0===this.files.length)&&(this.$uploaderContainer.append(this.$selectCard),this.$selectCard.on("click",this.handleFileSelect.bind(this)))}createDefaultFiles(e){let i=[];this.options.defaultValue?i=this.options.defaultValue:e&&(this.options.multiple?e.split(","):[e]).forEach(((e,t)=>{i.push({name:"default"+t,url:e})})),i.forEach((e=>{let i=n(),l=t()(`<div class="jquery-uploader-card" id="${i}">\n                    <div class="jquery-uploader-preview-main">\n                        <div class="jquery-uploader-preview-action">\n                            <ul>\n                                <li class="file-delete"><i class="fa fa-trash-o"></i></li>\n                            </ul>\n                        </div>\n                        <img src="${e.url}" alt="preview"/>\n                    </div>\n                 </div>`);l.find(a).on("click",this.handleFileDelete.bind(this)),this.files.push({id:i,name:e.name,url:e.url,status:d.fileStatus.initial,file:null,$ele:l})})),this.refreshPreviewFileList(),this.refreshValue()}onFileUploadUpdate(e,i){e.$ele.find(".jquery-uploader-preview-progress > .progress-mask").css("height",100-i+"%")}onFileUploadSuccess(e,i){let t;this.$originEle.trigger("upload-success",e,i),e.$ele.find(o).hide(),e.$ele.find(s).show();try{if(t=this.options.ajaxConfig.responseConverter(e,i),!t.url)return console.error("数据格式错误，没有url字段"),void this.onFileUploadError(e,"数据格式错误，没有url字段")}catch(i){return console.error("数据转换异常",i),void this.onFileUploadError(e,"数据转换异常")}e.name=t.name||e.name,e.url=t.url,e.status=d.fileStatus.uploaded,e.$ele.find(".jquery-uploader-preview-main > img").attr("src",e.url),this.refreshPreviewFileList(),this.refreshValue()}onFileUploadError(e,i){this.$originEle.trigger("upload-error",e,i),e.$ele.find(o).hide(),e.$ele.find(s).show(),e.$ele.attr("title",i),e.$ele.css("border-color","red")}handleFileSelect(){t()(`<input type="file" ${this.options.multiple?"multiple":""} />`).on("change",(e=>{this.handleFileAdd(e.target.files)})).click()}handleFileAdd(e){const i=window.URL||window.webkitURL;let l=[];for(let r=0;r<e.length;r++){let s=e[r],a=-1!==s.type.indexOf("image")?i.createObjectURL(s):null,o=n(),u=t()(`<div class="jquery-uploader-card" id="${o}">\n                    <div class="jquery-uploader-preview-main">\n                        <div class="jquery-uploader-preview-action">\n                            <ul>\n                                <li class="file-delete"><i class="fa fa-trash-o"></i></li>\n                            </ul>\n                        </div>\n                        <div class="jquery-uploader-preview-progress">\n                            <div class="progress-mask"></div>\n                            <div class="progress-loading">\n                                <i class="fa fa-spinner fa-spin"></i>\n                            </div>\n                        </div>\n                        <img src="${a}"/>\n                    </div>\n                 </div>`);u.find(".jquery-uploader-preview-action").hide(),l.push({id:o,name:s.name,url:a,status:d.fileStatus.selected,file:s,$ele:u})}this.files.push(...l),this.refreshPreviewFileList(),this.$originEle.trigger("file-add",l),!0===this.options.autoUpload&&this.handleFileUpload()}handleFileUpload(){let e=[];this.files.forEach((i=>{i.status===d.fileStatus.selected&&e.push(i)})),this.$originEle.trigger("before-upload",e),e.forEach((e=>{this.$originEle.trigger("uploading",e);try{this.options.ajaxConfig.ajaxRequester(this.options.ajaxConfig,e,(i=>{this.onFileUploadUpdate(e,i)}),(i=>{this.onFileUploadSuccess(e,i)}),(i=>{this.onFileUploadError(e,i)}))}catch(i){this.onFileUploadError(e,"ajax请求异常")}}))}handleFileDelete(e){let i=t()(e.target).parents(".jquery-uploader-card"),l=i[0].id;i.remove();let r=-1;this.files.forEach(((e,i)=>{e.id===l&&(r=i)}));let s=this.files.splice(r,1);this.$originEle.trigger("file-remove",...s),this.refreshValue(),this.refreshPreviewFileList()}}d.config={paramsBuilder:function(e){let i=new FormData;return i.append("file",e.file),i},responseConverter:function(e,i){return{url:i.data,name:null}},ajaxRequester:function(e,i,l,r,s){t().ajax({url:e.url,contentType:!1,processData:!1,method:e.method,data:e.paramsBuilder(i),success:function(e){r(e)},error:function(e){console.error("上传异常",e),s("上传异常")},xhr:function(){let e=new XMLHttpRequest;return e.upload.addEventListener("progress",(function(e){let i=e.loaded/e.total*100;l(i)})),e}})}},d.mode={url:"url",file:"file",custom:"custom"},d.fileStatus={selected:"selected",uploading:"uploading",uploaded:"uploaded",error:"error",initial:" initial"},d.defaults={mode:d.mode.url,multiple:!1,defaultValue:null,parent:null,allowFileExt:"*",autoUpload:!0,ajaxConfig:{url:"",method:"post",paramsBuilder:d.config.paramsBuilder,ajaxRequester:d.config.ajaxRequester,responseConverter:d.config.responseConverter}},$.fn.uploader=function(e,...i){if("string"==typeof e){let t=$(this[0]).data(l);if(!t)throw"this is not a uploader instance";return t[e](...i)}return this.each((function(){let i=$(this),t=i.data(l);t||(t=new d(i,e||{}),i.data(l,t))}))},$.fn.uploaderSetup=function(e){window[r]=e},$.Uploader=d})();